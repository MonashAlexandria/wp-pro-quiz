(function(e){e.wpProQuizFront=function(v,f){var b=e(v),c=this,g={},B=0,i=null,C=0,D=0,q=0,E=0,r=0,w=0,F=0,G=0,x=0,H=0,L=b.find('input[name="back"]'),I=b.find('input[name="next"]'),n=b.find(".wpProQuiz_quiz"),p=b.find(".wpProQuiz_list"),s=b.find(".wpProQuiz_results"),t=b.find(".wpProQuiz_text"),u=b.find(".wpProQuiz_time_limit"),y=b.find(".wpProQuiz_toplistShowInButton"),J="",z=f.timelimit,K=0,A={stop:function(){z&&(window.clearInterval(K),u.hide())},start:function(){if(z){var a=z,d=100*a,b=d,e=u.find("span"),
f=u.find(".wpProQuiz_progress");u.show();K=window.setInterval(function(){0==d%100&&e.text(c.methode.parseTime(a--));f.css("width",100*(d/b)+"%");0==d--&&(A.stop(),c.methode.finishQuiz(!0))},10)}}};c.methode={parseBitOptions:function(){if(f.bo){C=f.bo&1;D=f.bo&2;q=f.bo&4;E=f.bo&8;r=f.bo&16;var a=f.bo&32;a&&(void 0!=jQuery.support&&void 0!=jQuery.support.cors&&!1==jQuery.support.cors)&&(w=a)}},setClozeStyle:function(){b.find(".wpProQuiz_cloze").each(function(){var a=e(this).children(),d=a.eq(0),a=a.eq(1).clone();
a.css("visibility","hidden");e("body").append(a);var b=a.width();a.remove();d.width(b+10)})},parseTime:function(a){var d=parseInt(a%60),b=parseInt(a/60%60),a=parseInt(a/3600%24);return(9<a?"":"0")+a+":"+((9<b?"":"0")+b)+":"+((9<d?"":"0")+d)},cleanupCurlyQuotes:function(a){a=a.replace(/\u2018/,"'");a=a.replace(/\u2019/,"'");a=a.replace(/\u201C/,'"');a=a.replace(/\u201D/,'"');return e.trim(a).toLowerCase()},resetMatrix:function(a){a.each(function(){var a=e(this),b=a.find(".wpProQuiz_sortStringList");
a.find(".wpProQuiz_sortStringItem").each(function(){b.append(e(this))})})},marker:function(a,d){q||(d?a.addClass("wpProQuiz_answerCorrect"):a.addClass("wpProQuiz_answerIncorrect"))},startQuiz:function(){if(x)F=1;else if(G)t.hide(),b.find(".wpProQuiz_lock").show();else if(H)t.hide(),b.find(".wpProQuiz_prerequisite").show();else{c.methode.loadQuizData();D&&c.methode.random(p);C&&c.methode.random(b.find(".wpProQuiz_questionList"));c.methode.random(b.find(".wpProQuiz_sortStringList"));c.methode.random(b.find('[data-type="sort_answer"]'));
b.find(".wpProQuiz_listItem").each(function(a){var b=e(this);b.find(".wpProQuiz_question_page span:eq(0)").text(a+1);b.find("> h3 span").text(a+1);b.find(".wpProQuiz_questionListItem").each(function(a){e(this).find("> span").text(a+1+". ")})});switch(f.mode){case 3:b.find('input[name="checkSingle"]').show();b.find(".wpProQuiz_question_page").hide();break;case 2:b.find('input[name="check"]').show();break;case 1:b.find('input[name="back"]').slice(1).show();case 0:I.show()}var a=p.children();3==f.mode?
a.show():i=a.eq(0).show();b.find(".wpProQuiz_sortable").parents("ul").sortable().disableSelection();b.find(".wpProQuiz_sortStringList, .wpProQuiz_maxtrixSortCriterion").sortable({connectWith:".wpProQuiz_maxtrixSortCriterion:not(:has(li)), .wpProQuiz_sortStringList",placeholder:"wpProQuiz_placehold"}).disableSelection();A.start();B=+new Date;g={comp:{points:0,correctQuestions:0}};t.hide();n.show()}},nextQuestion:function(){i=i.hide().next().show();c.methode.scrollTo(n);i.length||c.methode.finishQuiz()},
prevQuestion:function(){i=i.hide().prev().show();c.methode.scrollTo(n)},finishQuiz:function(a){A.stop();var d=(+new Date-B)/1E3,d=f.timelimit&&d>f.timelimit?f.timelimit:d;b.find(".wpProQuiz_quiz_time span").text(c.methode.parseTime(d));a&&s.find(".wpProQuiz_time_limit_expired").show();c.methode.checkQuestion(p.children());b.find(".wpProQuiz_correct_answer").text(g.comp.correctQuestions);a=Math.round(1E4*(g.comp.points/f.globalPoints))/100;$pointFields=b.find(".wpProQuiz_points span");$pointFields.eq(0).text(g.comp.points);
$pointFields.eq(1).text(f.globalPoints);$pointFields.eq(2).text(a+"%");b.find(".wpProQuiz_resultsList > li").eq(c.methode.findResultIndex(a)).show();c.methode.setAverageResult(a,!1);c.methode.sendCompletedQuiz();n.hide();s.show();c.methode.scrollTo(s)},sendCompletedQuiz:function(){r||c.methode.ajax({action:"wp_pro_quiz_completed_quiz",quizId:f.quizId,results:g})},findResultIndex:function(a){for(var b=f.resultsGrade,c=-1,e=999999,g=0;g<b.length;g++){var h=b[g];a>=h&&a-h<e&&(e=a-h,c=g)}return c},showQustionList:function(){y.hide();
n.toggle();b.find(".wpProQuiz_QuestionButton").hide();p.children().show();b.find(".wpProQuiz_question_page").hide()},random:function(a){a.each(function(){var a=e(this).children().get().sort(function(){return Math.round(Math.random())-0.5});e(a).appendTo(a[0].parentNode)})},restartQuiz:function(){s.hide();t.show();p.children().hide();y.hide();b.find(".wpProQuiz_questionInput, .wpProQuiz_cloze input").removeAttr("disabled").removeAttr("checked").val("").css("background-color","");b.find(".wpProQuiz_answerCorrect, .wpProQuiz_answerIncorrect").removeClass("wpProQuiz_answerCorrect wpProQuiz_answerIncorrect");
b.find(".wpProQuiz_listItem").data("check",!1);b.find(".wpProQuiz_response").hide().children().hide();c.methode.resetMatrix(b.find(".wpProQuiz_listItem"));b.find(".wpProQuiz_sortStringItem, .wpProQuiz_sortable").removeAttr("style");b.find(".wpProQuiz_clozeCorrect, .wpProQuiz_QuestionButton, .wpProQuiz_resultsList > li").hide();b.find('.wpProQuiz_question_page, input[name="tip"]').show()},checkQuestion:function(a){a=void 0==a?i:a;a.each(function(){var a,b,j=e(this),l=j.find(".wpProQuiz_questionList"),
h=f.json[l.data("question_id")];a=h.type;if(j.data("check"))return!0;if("single"==h.type||"multiple"==h.type)a="singleMulti";var m=!0,k=0,i=e.isArray(h.points);({singleMulti:function(){var a=l.find(".wpProQuiz_questionInput").attr("disabled","disabled");l.children().each(function(b){var d=e(this),f=d.data("pos"),b=a.eq(b).is(":checked");h.correct[f]?(c.methode.marker(d,!0),b?i&&(k+=h.points[f]):m=!1):b?(c.methode.marker(d,!1),m=!1):i&&(k+=h.points[f])})},sort_answer:function(){var a=l.children();
a.each(function(a){var b=e(this);a==b.data("pos")?(c.methode.marker(b,!0),i&&(k+=h.points[a])):(c.methode.marker(b,!1),m=!1)});a.children().css({"box-shadow":"0 0",cursor:"auto"});l.sortable("destroy");a.sort(function(a,b){return e(a).data("pos")>e(b).data("pos")?1:-1});l.append(a)},matrix_sort_answer:function(){var a=[];l.children().each(function(){var b=e(this),d=b.data("pos"),b=b.find(".wpProQuiz_maxtrixSortCriterion"),f=b.children();d==f.data("pos")?(c.methode.marker(b,!0),i&&(k+=h.points[d])):
(m=!1,c.methode.marker(b,!1));a[d]=b});c.methode.resetMatrix(j);j.find(".wpProQuiz_sortStringItem").each(function(){var b=a[e(this).data("pos")];void 0!=b&&b.append(this)}).css({"box-shadow":"0 0",cursor:"auto"});j.find(".wpProQuiz_sortStringList, .wpProQuiz_maxtrixSortCriterion").sortable("destroy")},free_answer:function(){var a=l.children(),b=a.find(".wpProQuiz_questionInput").attr("disabled","disabled").val();0<=e.inArray(e.trim(b).toLowerCase(),h.correct)?c.methode.marker(a,!0):(c.methode.marker(a,
!1),m=!1)},cloze_answer:function(){l.find(".wpProQuiz_cloze").each(function(a){var b=e(this).children(),d=b.eq(0),b=b.eq(1),f=c.methode.cleanupCurlyQuotes(d.val()),g=c.methode.cleanupCurlyQuotes(b.text()),g=e.trim(g.substr(1,g.length-2));f==g?(i&&(k+=h.points[a]),q||d.css("background-color","#B0DAB0")):(q||d.css("background-color","#FFBABA"),m=!1,b.show());d.attr("disabled","disabled")})}})[a]();!i&&m&&(k=h.points);a=m;b=k;j.find(".wpProQuiz_response").show();j.find('input[name="check"]').hide();
j.find('input[name="next"]').show();void 0==g[h.id]&&(g[h.id]={});g[h.id].points=b;g[h.id].correct=Number(a);g.comp.points+=b;a?(j.find(".wpProQuiz_correct").show(),g.comp.correctQuestions+=1):j.find(".wpProQuiz_incorrect").show();j.find(".wpProQuiz_responsePoints").text(b);j.data("check",!0)})},showTip:function(){var a=e(this),d=a.siblings(".wpProQuiz_question").find(".wpProQuiz_questionList").data("question_id");a.siblings(".wpProQuiz_tipp").toggle("fast");void 0==g[d]&&(g[d]={});g[d].tip=1;e(document).bind("mouseup.tipEvent",
function(a){var d=b.find(".wpProQuiz_tipp"),c=b.find('input[name="tip"]');!d.is(a.target)&&(0==d.has(a.target).length&&!c.is(a.target))&&(d.hide("fast"),e(document).unbind(".tipEvent"))})},ajax:function(a,b,c){w&&(jQuery.support.cors=!0);e.post(WpProQuizGlobal.ajaxurl,a,b,c||"json");w&&(jQuery.support.cors=!1)},checkQuizLock:function(){x=1;c.methode.ajax({action:"wp_pro_quiz_check_lock",quizId:f.quizId},function(a){void 0!=a.lock&&(G=a.lock.is,a.lock.pre&&b.find('input[name="restartQuiz"]').hide());
void 0!=a.prerequisite&&(H=1,b.find(".wpProQuiz_prerequisite span").text(a.prerequisite));x=0;F&&c.methode.startQuiz()})},loadQuizData:function(){c.methode.ajax({action:"wp_pro_quiz_load_quiz_data",quizId:f.quizId},function(a){a.toplist&&c.methode.handleToplistData(a.toplist);void 0!=a.averageResult&&c.methode.setAverageResult(a.averageResult,!0)})},setAverageResult:function(a,d){var c=b.find(".wpProQuiz_resultValue:eq("+(d?0:1)+") >");c.eq(1).text(a+"%");c.eq(0).css("width",240*a/100+"px")},handleToplistData:function(a){var d=
b.find(".wpProQuiz_addToplist"),c=d.find(".wpProQuiz_addBox").show().children("div");a.canAdd?(d.show(),d.find(".wpProQuiz_addToplistMessage").hide(),d.find(".wpProQuiz_toplistButton").show(),J=a.token,a.userId?c.hide():(c.show(),d=c.children().eq(1),a.captcha?(d.find('input[name="wpProQuiz_captchaPrefix"]').val(a.captcha.code),d.find(".wpProQuiz_captchaImg").attr("src",a.captcha.img),d.find('input[name="wpProQuiz_captcha"]').val(""),d.show()):d.hide())):d.hide()},scrollTo:function(a){a=a.offset().top-
100;(window.pageYOffset||document.body.scrollTop)>a&&e("html,body").animate({scrollTop:a},300)},addToplist:function(){if(!r){var a=b.find(".wpProQuiz_addToplistMessage").text(WpProQuizGlobal.loadData).show(),d=b.find(".wpProQuiz_addBox").hide();c.methode.ajax({action:"wp_pro_quiz_add_toplist",quizId:f.quizId,token:J,name:d.find('input[name="wpProQuiz_toplistName"]').val(),email:d.find('input[name="wpProQuiz_toplistEmail"]').val(),captcha:d.find('input[name="wpProQuiz_captcha"]').val(),prefix:d.find('input[name="wpProQuiz_captchaPrefix"]').val(),
points:g.comp.points,totalPoints:f.globalPoints},function(b){a.text(b.text);b.clear?d.hide():d.show();b.captcha&&(d.find(".wpProQuiz_captchaImg").attr("src",b.captcha.img),d.find('input[name="wpProQuiz_captchaPrefix"]').val(b.captcha.code),d.find('input[name="wpProQuiz_captcha"]').val(""))})}}};c.init=function(){c.methode.parseBitOptions();c.methode.setClozeStyle();E&&!r&&c.methode.checkQuizLock();b.find('input[name="startQuiz"]').click(function(){c.methode.startQuiz();return!1});I.click(function(){c.methode.nextQuestion()});
L.click(function(){c.methode.prevQuestion()});b.find('input[name="reShowQuestion"]').click(function(){c.methode.showQustionList()});b.find('input[name="restartQuiz"]').click(function(){c.methode.restartQuiz()});b.find('input[name="check"]').click(function(){c.methode.checkQuestion()});b.find('input[name="checkSingle"]').click(function(){c.methode.finishQuiz()});b.find('input[name="tip"]').click(c.methode.showTip);b.find('input[name="wpProQuiz_toplistAdd"]').click(c.methode.addToplist);b.find('input[name="showToplist"]').click(function(){n.hide();
y.toggle()})};c.init()};e.fn.wpProQuizFront=function(v){return this.each(function(){void 0==e(this).data("wpProQuizFront")&&e(this).data("wpProQuizFront",new e.wpProQuizFront(this,v))})}})(jQuery);
