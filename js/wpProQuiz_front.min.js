(function(c){c.wpProQuizFront=function(n,e){var b=c(n),f=this,m=0,i=0,r=0,j={},l=0,k=0,s=!1,t=!1,p=!1,q=!1;f.methode={preStartQuiz:function(){j={};e.questionRandom&&f.methode.questionRandom();e.answerRandom?f.methode.answerRandom(".wpProQuiz_questionList"):f.methode.answerRandom(b.find(".wpProQuiz_sortable").parent().parent());f.methode.answerRandom(".wpProQuiz_sortStringList");l=m=0;e.checkAnswer?b.find('input[name="check"]').show():b.find('input[name="next"]').show();!s||!p?f.methode.startQuiz():
q=!0},startQuiz:function(){b.find(".wpProQuiz_text").hide();t?b.find(".wpProQuiz_lock").show():(r=new Date,e.timeLimit&&f.methode.setTimeLimit(),b.find(".wpProQuiz_quiz").show(),b.find(".wpProQuiz_listItem").first().fadeIn(200),b.find(".wpProQuiz_sortable").parent().parent().sortable().disableSelection(),b.find(".wpProQuiz_sortStringList, .wpProQuiz_maxtrixSortCriterion").sortable({connectWith:".wpProQuiz_maxtrixSortCriterion:not(:has(li)), .wpProQuiz_sortStringList",placeholder:"wpProQuiz_placehold"}).disableSelection())},
reStartQuiz:function(){b.find(".wpProQuiz_answerCorrect").removeClass("wpProQuiz_answerCorrect");b.find(".wpProQuiz_answerIncorrect").removeClass("wpProQuiz_answerIncorrect");b.find('.wpProQuiz_text, input[name="tip"]').show();b.find(".wpProQuiz_quiz, .wpProQuiz_results, .wpProQuiz_response, .wpProQuiz_correct, .wpProQuiz_incorrect").hide();b.find(".wpProQuiz_time_limit, .wpProQuiz_time_limit_expired, .wpProQuiz_sort_correct_answer").hide();b.find(".wpProQuiz_quiz").children().first().children().hide();
b.find(".wpProQuiz_sortable, .wpProQuiz_sortStringItem").removeAttr("style");b.find('input[name="check"]').hide();b.find('input[name="next"]').hide();b.find(".wpProQuiz_questionInput").removeAttr("disabled").removeAttr("checked");b.find('input.wpProQuiz_questionInput[type="text"]').removeAttr("value");b.find(".wpProQuiz_resultsList").children().hide();b.find(".wpProQuiz_cloze input").removeAttr("disabled").removeAttr("value").css("background-color","");b.find(".wpProQuiz_cloze span").hide();f.methode.resetMatrix();
b.find(".wpProQuiz_listItem").data("isChecked",!1)},resetMatrix:function(){b.find(".wpProQuiz_question").each(function(){var a=c(this),d=a.find(".wpProQuiz_sortStringList");a.find(".wpProQuiz_sortStringItem").each(function(){d.append(c(this))})})},setTimeLimit:function(){var a=b.find(".wpProQuiz_time_limit"),d=a.find("span"),c=e.timeLimit;a.css({width:"100%",display:"block"});d.html(f.methode.parseTime(c));a.find(".progress").css("width","100%").animate({width:"0%"},1E3*e.timeLimit);i=setInterval(function(){d.html(f.methode.parseTime(c--));
0>c&&(clearInterval(i),i=0,a.find(".progress").clearQueue().stop(),b.find('input[name="check"]').click().parent().hide(),b.find(".wpProQuiz_time_limit_expired").show(),f.methode.showResult())},1E3)},parseTime:function(a){var d=parseInt(a%60),c=parseInt(a/60%60),a=parseInt(a/3600%24);return(9<a?"":"0")+a+":"+((9<c?"":"0")+c)+":"+((9<d?"":"0")+d)},setQuizTime:function(){var a=((new Date).getTime()-r.getTime())/1E3;b.find(".wpProQuiz_quiz_time span").first().html(f.methode.parseTime(a))},setData:function(){var a=
0;b.find(".wpProQuiz_questionList").each(function(){var d=e.json[a],b=0;k+=d.points;c(this).parent().parent().data("type",d.answer_type).data("questionId",d.id).data("points",d.points);c(this).find(".wpProQuiz_questionInput").each(function(){switch(d.answer_type){case "single":case "multiple":0<=c.inArray(this.value,d.correct)?c(this).data("correct","1"):c(this).data("correct","0");break;case "free_answer":c(this).data("correct",d.correct)}});b=0;c(this).find(".wpProQuiz_sortable").each(function(){c(this).data("correct",
d.correct[b++])});b=0;c(this).parent().find(".wpProQuiz_sortStringList").children().each(function(){c(this).data("correct",d.correct[b++])});"matrix_sort_answer"==d.answer_type&&c(this).children().each(function(){c(this).data("correct",c(this).index())});a++})},checkAnswer:function(a){var d=c(a).parent(),b=!1,e=d.find(".wpProQuiz_questionInput"),h=d.data("type");d.find('input[name="tip"]').hide();if(!d.data("isChecked")){if("multiple"==h||"single"==h){var g=!0;e.each(function(){"1"==c(this).data("correct")?
(c(this).parent().parent().addClass("wpProQuiz_answerCorrect"),g=this.checked?g&1:g&0):this.checked&&(c(this).parent().parent().addClass("wpProQuiz_answerIncorrect"),g&=0)});b=g}else if("sort_answer"==h){g=!0;d.find(".wpProQuiz_sortable").each(function(){var a=c(this),b=a.parent().index();a.data("correct")==b?(a.parent().addClass("wpProQuiz_answerCorrect"),g&=1):(a.parent().addClass("wpProQuiz_answerIncorrect"),g=!1);a.css({"box-shadow":"0 0",cursor:"auto"})});var i=d.find(".wpProQuiz_sortable").parent().parent(),
b=i.children("li");i.sortable("destroy");b.sort(function(a,b){return c(a).children("div").data("correct")-c(b).children("div").data("correct")});c.each(b,function(a,b){i.append(b)});b=g}else if("free_answer"==h)h=c.trim(e.val()).toLowerCase(),0<=c.inArray(h,e.data("correct"))?(b=!0,e.parent().parent().addClass("wpProQuiz_answerCorrect")):e.parent().parent().addClass("wpProQuiz_answerIncorrect");else if("matrix_sort_answer"==h){var g=!0,k={};d.find(".wpProQuiz_questionList").children().each(function(){var a=
c(this).data("correct"),b=c(this).find(".wpProQuiz_maxtrixSortCriterion");b.children().first().data("correct")==a?(g&=1,b.addClass("wpProQuiz_answerCorrect")):(g=!1,b.addClass("wpProQuiz_answerIncorrect"));k[a]=c(this)});d.find(".wpProQuiz_sortStringItem").each(function(){k[c(this).data("correct")].find(".wpProQuiz_maxtrixSortCriterion").append(this)}).css({"box-shadow":"0 0",cursor:"auto"});d.find(".wpProQuiz_sortStringList, .wpProQuiz_maxtrixSortCriterion").sortable("destroy");b=g}else"cloze_answer"==
h&&(g=!0,d.find(".wpProQuiz_cloze").each(function(){var a=c(this).children(),b=a.first(),d=b.val().toLowerCase(),e=a.last().text().toLowerCase(),e=c.trim(e.substr(1,e.length-2)),e=f.methode.cleanupCurlyQuotes(e),d=f.methode.cleanupCurlyQuotes(c.trim(d));e==d?(g&=1,b.css("background-color","#B0DAB0")):(g=!1,b.css("background-color","#FFBABA"),a.last().show());b.attr("disabled","disabled")}),b=g);c(a).hide();e.attr("disabled","disabled");void 0==j[d.data("questionId")]&&(j[d.data("questionId")]={});
j[d.data("questionId")].correct=Number(b);d.find(".wpProQuiz_response").show();b?(d.find(".wpProQuiz_correct").show(),m++,l+=d.data("points")):d.find(".wpProQuiz_incorrect").show();d.find('input[name="next"]').show();d.data("isChecked",!0)}},nextQuestion:function(a){var a=c(a).parent(),d=a.next();a.hide();d.length?(d.show(),e.backButton&&!e.checkAnswer&&d.find('input[name="back"]').show()):(e.checkAnswer||b.find('input[name="check"]').click(),f.methode.showResult())},backQuestion:function(a){var a=
c(a).parent(),b=a.prev();a.hide();b.show()},showResult:function(){clearInterval(i);var a=b.find(".wpProQuiz_points span");b.find(".wpProQuiz_time_limit .progress").clearQueue().stop();b.find(".wpProQuiz_correct_answer").html(m);b.find(".wpProQuiz_results").show();b.find(".wpProQuiz_time_limit").hide();f.methode.setQuizTime();var d=Math.round(1E4*(l/k))/100;a.eq(0).text(l);a.eq(1).text(k);a.eq(2).text(d);a=f.methode.findResultIndex(d);-1<a&&b.find(".wpProQuiz_resultsList").children().eq(a).show();
f.methode.sendCompletedQuiz()},sendCompletedQuiz:function(){e.preview||c.post(e.url,{action:"wp_pro_quiz_completed_quiz",results:j,quizId:e.quizId})},findResultIndex:function(a){for(var b=e.resultsGrade,c=-1,f=999999,h=0;h<b.length;h++){var g=b[h];a>=g&&a-g<f&&(f=a-g,c=h)}return c},cleanupCurlyQuotes:function(a){a=a.replace(/\u2018/,"'");a=a.replace(/\u2019/,"'");a=a.replace(/\u201C/,'"');return a=a.replace(/\u201D/,'"')},reShowQuestion:function(){b.find('input[name="next"], input[name="check"], input[name="back"]').hide();
b.find(".wpProQuiz_quiz").children().first().children().show()},answerRandom:function(a){b.find(a).each(function(){var a=c(this).children(),a=a.sort(function(){return Math.round(Math.random())-0.5}).slice(0,a.length);c(a).appendTo(a[0].parentNode).show()})},questionRandom:function(){var a=b.find(".wpProQuiz_quiz ol").children(),a=a.sort(function(){return Math.round(Math.random())-0.5}).slice(0,a.length);c(a).appendTo(a[0].parentNode);var d=1;c(a).each(function(){c(this).find(".wpProQuiz_question_page span").eq(0).html(d);
c(this).find("h3 span").html(d++)})},showTip:function(a){$tip=c(a).siblings(".wpProQuiz_tipp");$par=c(a).parent();void 0==j[$par.data("questionId")]&&(j[$par.data("questionId")]={});j[$par.data("questionId")].tip=1;$tip.toggle("fast")},setClozeStyle:function(){b.find(".wpProQuiz_cloze").each(function(){var a=c(this).children(),b=a.first(),a=a.last().clone();a.css("visibility","hidden");c("body").append(a);var e=a.width();a.remove();b.width(e+10)})},checkLock:function(){p=!0;c.post(e.url,{action:"wp_pro_quiz_check_lock",
quizId:e.quizId},function(a){t=a.is;p=!1;a.pre&&b.find('input[name="restartQuiz"]').hide();q&&(q=!1,f.methode.startQuiz())},"json")}};f.init=function(){m=0;e.lock&&!e.preview&&(s=!0,f.methode.checkLock());void 0==e.resultsGrade&&(e.resultsGrade=[0]);b.find(".wpProQuiz_quiz, .wpProQuiz_results").hide();b.find(".wpProQuiz_quiz").children().first().children().hide();f.methode.setData();f.methode.setClozeStyle();b.find('input[name="startQuiz"]').click(function(a){a.preventDefault();f.methode.preStartQuiz()});
b.find('input[name="check"]').click(function(a){a.preventDefault();f.methode.checkAnswer(this)});b.find('input[name="next"]').click(function(a){a.preventDefault();f.methode.nextQuestion(this)});b.find('input[name="restartQuiz"]').click(function(a){a.preventDefault();f.methode.reStartQuiz()});b.find('input[name="reShowQuestion"]').click(function(a){a.preventDefault();f.methode.reShowQuestion(this)});b.find('input[name="back"]').click(function(){f.methode.backQuestion(this)});b.find('input[name="tip"]').click(function(){f.methode.showTip(this)});
c(document).mouseup(function(a){var c=b.find(".wpProQuiz_tipp"),e=b.find('input[name="tip"]');!c.is(a.target)&&(0==c.has(a.target).length&&!e.is(a.target))&&c.hide("fast")})};f.init()};c.fn.wpProQuizFront=function(n){return this.each(function(){void 0==c(this).data("wpProQuizFront")&&c(this).data("wpProQuizFront",new c.wpProQuizFront(this,n))})}})(jQuery);
