(function(d){d.wpProQuizFront=function(w,e){var b=d(w),c=this,f={},B=0,i=null,C=0,D=0,q=0,E=0,r=0,x=0,F=0,G=0,y=0,H=0,L=b.find('input[name="back"]'),I=b.find('input[name="next"]'),n=b.find(".wpProQuiz_quiz"),p=b.find(".wpProQuiz_list"),s=b.find(".wpProQuiz_results"),t=b.find(".wpProQuiz_text"),u=b.find(".wpProQuiz_time_limit"),z=b.find(".wpProQuiz_toplistShowInButton"),J="",v=e.timelimit,K=0,A={stop:function(){v&&(window.clearInterval(K),u.hide())},start:function(){if(v){var a=1E3*v,g=u.find("span").text(c.methode.parseTime(v)),
b=u.find(".wpProQuiz_progress");u.show();var d=+new Date;K=window.setInterval(function(){var e=+new Date-d,h=a-e;500<=e&&g.text(c.methode.parseTime(Math.ceil(h/1E3)));b.css("width",100*(h/a)+"%");0>=h&&(A.stop(),c.methode.finishQuiz(!0))},16)}}};c.methode={parseBitOptions:function(){if(e.bo){C=e.bo&1;D=e.bo&2;q=e.bo&4;E=e.bo&8;r=e.bo&16;var a=e.bo&32;a&&(void 0!=jQuery.support&&void 0!=jQuery.support.cors&&!1==jQuery.support.cors)&&(x=a)}},setClozeStyle:function(){b.find(".wpProQuiz_cloze").each(function(){var a=
d(this).children(),g=a.eq(0),a=a.eq(1).clone();a.css("visibility","hidden");d("body").append(a);var b=a.width();a.remove();g.width(b+10)})},parseTime:function(a){var g=parseInt(a%60),b=parseInt(a/60%60),a=parseInt(a/3600%24);return(9<a?"":"0")+a+":"+((9<b?"":"0")+b)+":"+((9<g?"":"0")+g)},cleanupCurlyQuotes:function(a){a=a.replace(/\u2018/,"'");a=a.replace(/\u2019/,"'");a=a.replace(/\u201C/,'"');a=a.replace(/\u201D/,'"');return d.trim(a).toLowerCase()},resetMatrix:function(a){a.each(function(){var a=
d(this),b=a.find(".wpProQuiz_sortStringList");a.find(".wpProQuiz_sortStringItem").each(function(){b.append(d(this))})})},marker:function(a,b){q||(b?a.addClass("wpProQuiz_answerCorrect"):a.addClass("wpProQuiz_answerIncorrect"))},startQuiz:function(){if(y)F=1;else if(G)t.hide(),b.find(".wpProQuiz_lock").show();else if(H)t.hide(),b.find(".wpProQuiz_prerequisite").show();else{c.methode.loadQuizData();D&&c.methode.random(p);C&&c.methode.random(b.find(".wpProQuiz_questionList"));c.methode.random(b.find(".wpProQuiz_sortStringList"));
c.methode.random(b.find('[data-type="sort_answer"]'));b.find(".wpProQuiz_listItem").each(function(a){var b=d(this);b.find(".wpProQuiz_question_page span:eq(0)").text(a+1);b.find("> h3 span").text(a+1);b.find(".wpProQuiz_questionListItem").each(function(a){d(this).find("> span").text(a+1+". ")})});switch(e.mode){case 3:b.find('input[name="checkSingle"]').show();b.find(".wpProQuiz_question_page").hide();break;case 2:b.find('input[name="check"]').show();break;case 1:b.find('input[name="back"]').slice(1).show();
case 0:I.show()}var a=p.children();3==e.mode?a.show():i=a.eq(0).show();b.find(".wpProQuiz_sortable").parents("ul").sortable().disableSelection();b.find(".wpProQuiz_sortStringList, .wpProQuiz_maxtrixSortCriterion").sortable({connectWith:".wpProQuiz_maxtrixSortCriterion:not(:has(li)), .wpProQuiz_sortStringList",placeholder:"wpProQuiz_placehold"}).disableSelection();A.start();B=+new Date;f={comp:{points:0,correctQuestions:0}};t.hide();n.show()}},nextQuestion:function(){i=i.hide().next().show();c.methode.scrollTo(n);
i.length||c.methode.finishQuiz()},prevQuestion:function(){i=i.hide().prev().show();c.methode.scrollTo(n)},finishQuiz:function(a){A.stop();var g=(+new Date-B)/1E3,g=e.timelimit&&g>e.timelimit?e.timelimit:g;b.find(".wpProQuiz_quiz_time span").text(c.methode.parseTime(g));a&&s.find(".wpProQuiz_time_limit_expired").show();c.methode.checkQuestion(p.children());b.find(".wpProQuiz_correct_answer").text(f.comp.correctQuestions);a=Math.round(1E4*(f.comp.points/e.globalPoints))/100;$pointFields=b.find(".wpProQuiz_points span");
$pointFields.eq(0).text(f.comp.points);$pointFields.eq(1).text(e.globalPoints);$pointFields.eq(2).text(a+"%");b.find(".wpProQuiz_resultsList > li").eq(c.methode.findResultIndex(a)).show();c.methode.setAverageResult(a,!1);c.methode.sendCompletedQuiz();n.hide();s.show();c.methode.scrollTo(s)},sendCompletedQuiz:function(){r||c.methode.ajax({action:"wp_pro_quiz_completed_quiz",quizId:e.quizId,results:f})},findResultIndex:function(a){for(var b=e.resultsGrade,c=-1,d=999999,f=0;f<b.length;f++){var h=b[f];
a>=h&&a-h<d&&(d=a-h,c=f)}return c},showQustionList:function(){z.hide();n.toggle();b.find(".wpProQuiz_QuestionButton").hide();p.children().show();b.find(".wpProQuiz_question_page").hide()},random:function(a){a.each(function(){var a=d(this).children().get().sort(function(){return Math.round(Math.random())-0.5});d(a).appendTo(a[0].parentNode)})},restartQuiz:function(){s.hide();t.show();p.children().hide();z.hide();b.find(".wpProQuiz_questionInput, .wpProQuiz_cloze input").removeAttr("disabled").removeAttr("checked").val("").css("background-color",
"");b.find(".wpProQuiz_answerCorrect, .wpProQuiz_answerIncorrect").removeClass("wpProQuiz_answerCorrect wpProQuiz_answerIncorrect");b.find(".wpProQuiz_listItem").data("check",!1);b.find(".wpProQuiz_response").hide().children().hide();c.methode.resetMatrix(b.find(".wpProQuiz_listItem"));b.find(".wpProQuiz_sortStringItem, .wpProQuiz_sortable").removeAttr("style");b.find(".wpProQuiz_clozeCorrect, .wpProQuiz_QuestionButton, .wpProQuiz_resultsList > li").hide();b.find('.wpProQuiz_question_page, input[name="tip"]').show()},
checkQuestion:function(a){a=void 0==a?i:a;a.each(function(){var a,b,j=d(this),l=j.find(".wpProQuiz_questionList"),h=e.json[l.data("question_id")];a=h.type;if(j.data("check"))return!0;if("single"==h.type||"multiple"==h.type)a="singleMulti";var m=!0,k=0,i=d.isArray(h.points);({singleMulti:function(){var a=l.find(".wpProQuiz_questionInput").attr("disabled","disabled");l.children().each(function(b){var g=d(this),e=g.data("pos"),b=a.eq(b).is(":checked");h.correct[e]?(c.methode.marker(g,!0),b?i&&(k+=h.points[e]):
m=!1):b?(c.methode.marker(g,!1),m=!1):i&&(k+=h.points[e])})},sort_answer:function(){var a=l.children();a.each(function(a){var b=d(this);a==b.data("pos")?(c.methode.marker(b,!0),i&&(k+=h.points[a])):(c.methode.marker(b,!1),m=!1)});a.children().css({"box-shadow":"0 0",cursor:"auto"});l.sortable("destroy");a.sort(function(a,b){return d(a).data("pos")>d(b).data("pos")?1:-1});l.append(a)},matrix_sort_answer:function(){var a=[];l.children().each(function(){var b=d(this),g=b.data("pos"),b=b.find(".wpProQuiz_maxtrixSortCriterion"),
e=b.children();g==e.data("pos")?(c.methode.marker(b,!0),i&&(k+=h.points[g])):(m=!1,c.methode.marker(b,!1));a[g]=b});c.methode.resetMatrix(j);j.find(".wpProQuiz_sortStringItem").each(function(){var b=a[d(this).data("pos")];void 0!=b&&b.append(this)}).css({"box-shadow":"0 0",cursor:"auto"});j.find(".wpProQuiz_sortStringList, .wpProQuiz_maxtrixSortCriterion").sortable("destroy")},free_answer:function(){var a=l.children(),b=a.find(".wpProQuiz_questionInput").attr("disabled","disabled").val();0<=d.inArray(d.trim(b).toLowerCase(),
h.correct)?c.methode.marker(a,!0):(c.methode.marker(a,!1),m=!1)},cloze_answer:function(){l.find(".wpProQuiz_cloze").each(function(a){var b=d(this).children(),g=b.eq(0),b=b.eq(1),e=c.methode.cleanupCurlyQuotes(g.val()),f=c.methode.cleanupCurlyQuotes(b.text()),f=d.trim(f.substr(1,f.length-2));e==f?(i&&(k+=h.points[a]),q||g.css("background-color","#B0DAB0")):(q||g.css("background-color","#FFBABA"),m=!1,b.show());g.attr("disabled","disabled")})}})[a]();!i&&m&&(k=h.points);a=m;b=k;j.find(".wpProQuiz_response").show();
j.find('input[name="check"]').hide();j.find('input[name="next"]').show();void 0==f[h.id]&&(f[h.id]={});f[h.id].points=b;f[h.id].correct=Number(a);f.comp.points+=b;a?(j.find(".wpProQuiz_correct").show(),f.comp.correctQuestions+=1):j.find(".wpProQuiz_incorrect").show();j.find(".wpProQuiz_responsePoints").text(b);j.data("check",!0)})},showTip:function(){var a=d(this),c=a.siblings(".wpProQuiz_question").find(".wpProQuiz_questionList").data("question_id");a.siblings(".wpProQuiz_tipp").toggle("fast");void 0==
f[c]&&(f[c]={});f[c].tip=1;d(document).bind("mouseup.tipEvent",function(a){var c=b.find(".wpProQuiz_tipp"),g=b.find('input[name="tip"]');!c.is(a.target)&&(0==c.has(a.target).length&&!g.is(a.target))&&(c.hide("fast"),d(document).unbind(".tipEvent"))})},ajax:function(a,b,c){x&&(jQuery.support.cors=!0);d.post(WpProQuizGlobal.ajaxurl,a,b,c||"json");x&&(jQuery.support.cors=!1)},checkQuizLock:function(){y=1;c.methode.ajax({action:"wp_pro_quiz_check_lock",quizId:e.quizId},function(a){void 0!=a.lock&&(G=
a.lock.is,a.lock.pre&&b.find('input[name="restartQuiz"]').hide());void 0!=a.prerequisite&&(H=1,b.find(".wpProQuiz_prerequisite span").text(a.prerequisite));y=0;F&&c.methode.startQuiz()})},loadQuizData:function(){c.methode.ajax({action:"wp_pro_quiz_load_quiz_data",quizId:e.quizId},function(a){a.toplist&&c.methode.handleToplistData(a.toplist);void 0!=a.averageResult&&c.methode.setAverageResult(a.averageResult,!0)})},setAverageResult:function(a,c){var d=b.find(".wpProQuiz_resultValue:eq("+(c?0:1)+") >");
d.eq(1).text(a+"%");d.eq(0).css("width",240*a/100+"px")},handleToplistData:function(a){var c=b.find(".wpProQuiz_addToplist"),d=c.find(".wpProQuiz_addBox").show().children("div");a.canAdd?(c.show(),c.find(".wpProQuiz_addToplistMessage").hide(),c.find(".wpProQuiz_toplistButton").show(),J=a.token,a.userId?d.hide():(d.show(),c=d.children().eq(1),a.captcha?(c.find('input[name="wpProQuiz_captchaPrefix"]').val(a.captcha.code),c.find(".wpProQuiz_captchaImg").attr("src",a.captcha.img),c.find('input[name="wpProQuiz_captcha"]').val(""),
c.show()):c.hide())):c.hide()},scrollTo:function(a){a=a.offset().top-100;(window.pageYOffset||document.body.scrollTop)>a&&d("html,body").animate({scrollTop:a},300)},addToplist:function(){if(!r){var a=b.find(".wpProQuiz_addToplistMessage").text(WpProQuizGlobal.loadData).show(),d=b.find(".wpProQuiz_addBox").hide();c.methode.ajax({action:"wp_pro_quiz_add_toplist",quizId:e.quizId,token:J,name:d.find('input[name="wpProQuiz_toplistName"]').val(),email:d.find('input[name="wpProQuiz_toplistEmail"]').val(),
captcha:d.find('input[name="wpProQuiz_captcha"]').val(),prefix:d.find('input[name="wpProQuiz_captchaPrefix"]').val(),points:f.comp.points,totalPoints:e.globalPoints},function(b){a.text(b.text);b.clear?d.hide():d.show();b.captcha&&(d.find(".wpProQuiz_captchaImg").attr("src",b.captcha.img),d.find('input[name="wpProQuiz_captchaPrefix"]').val(b.captcha.code),d.find('input[name="wpProQuiz_captcha"]').val(""))})}}};c.init=function(){c.methode.parseBitOptions();c.methode.setClozeStyle();E&&!r&&c.methode.checkQuizLock();
b.find('input[name="startQuiz"]').click(function(){c.methode.startQuiz();return!1});I.click(function(){c.methode.nextQuestion()});L.click(function(){c.methode.prevQuestion()});b.find('input[name="reShowQuestion"]').click(function(){c.methode.showQustionList()});b.find('input[name="restartQuiz"]').click(function(){c.methode.restartQuiz()});b.find('input[name="check"]').click(function(){c.methode.checkQuestion()});b.find('input[name="checkSingle"]').click(function(){c.methode.finishQuiz()});b.find('input[name="tip"]').click(c.methode.showTip);
b.find('input[name="wpProQuiz_toplistAdd"]').click(c.methode.addToplist);b.find('input[name="showToplist"]').click(function(){n.hide();z.toggle()})};c.init()};d.fn.wpProQuizFront=function(w){return this.each(function(){void 0==d(this).data("wpProQuizFront")&&d(this).data("wpProQuizFront",new d.wpProQuizFront(this,w))})}})(jQuery);
