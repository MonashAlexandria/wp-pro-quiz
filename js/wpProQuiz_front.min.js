(function(b){b.wpProQuizFront=function(p,d){var a=b(p),f=this,n=0,j=0,s=0,k={},m=0,l=0,t=!1,u=!1,q=!1,r=!1;f.methode={preStartQuiz:function(){k={};d.questionRandom&&f.methode.questionRandom();d.answerRandom?f.methode.answerRandom(".wpProQuiz_questionList"):f.methode.answerRandom(a.find(".wpProQuiz_sortable").parent().parent());f.methode.answerRandom(".wpProQuiz_sortStringList");m=n=0;d.questionOnSinglePage||(d.checkAnswer?a.find('input[name="check"]').show():a.find('input[name="next"]').show());!t||
!q?f.methode.startQuiz():r=!0;d.numberedAnswer&&f.methode.numberedAnswer()},startQuiz:function(){a.find(".wpProQuiz_text").hide();u?a.find(".wpProQuiz_lock").show():(s=new Date,d.timeLimit&&f.methode.setTimeLimit(),d.questionOnSinglePage&&a.find(".wpProQuiz_listItem").show(),a.find(".wpProQuiz_listItem").first().show(),a.find(".wpProQuiz_quiz").fadeIn(200),a.find(".wpProQuiz_sortable").parent().parent().sortable().disableSelection(),a.find(".wpProQuiz_sortStringList, .wpProQuiz_maxtrixSortCriterion").sortable({connectWith:".wpProQuiz_maxtrixSortCriterion:not(:has(li)), .wpProQuiz_sortStringList",
placeholder:"wpProQuiz_placehold"}).disableSelection())},scrollTo:function(c,e){var a=c.offset().top-100;e?(window.pageYOffset||document.body.scrollTop)>a&&b("html,body").animate({scrollTop:a},300):b("html,body").animate({scrollTop:a},300)},reStartQuiz:function(){a.find(".wpProQuiz_answerCorrect").removeClass("wpProQuiz_answerCorrect");a.find(".wpProQuiz_answerIncorrect").removeClass("wpProQuiz_answerIncorrect");a.find('.wpProQuiz_text, input[name="tip"]').show();a.find(".wpProQuiz_quiz, .wpProQuiz_results, .wpProQuiz_response, .wpProQuiz_correct, .wpProQuiz_incorrect").hide();
a.find(".wpProQuiz_time_limit, .wpProQuiz_time_limit_expired, .wpProQuiz_sort_correct_answer").hide();a.find(".wpProQuiz_quiz").children().first().children().hide();a.find(".wpProQuiz_sortable, .wpProQuiz_sortStringItem").removeAttr("style");a.find('input[name="check"]').hide();a.find('input[name="next"]').hide();a.find(".wpProQuiz_questionInput").removeAttr("disabled").removeAttr("checked");a.find('input.wpProQuiz_questionInput[type="text"]').removeAttr("value");a.find(".wpProQuiz_resultsList").children().hide();
a.find(".wpProQuiz_cloze input").removeAttr("disabled").removeAttr("value").css("background-color","");a.find(".wpProQuiz_cloze span").hide();a.find('input[name="checkSingle"]').show();d.questionOnSinglePage||a.find(".wpProQuiz_question_page").show();f.methode.resetMatrix();a.find(".wpProQuiz_listItem").data("isChecked",!1)},numberedAnswer:function(){a.find(".wpProQuiz_listItem").each(function(){var c=b(this),e=c.data("type"),a=1;("multiple"==e||"single"==e)&&c.find(".WpProQuiz_numberedAnswer").each(function(){b(this).text(a++ +
". ")})})},resetMatrix:function(){a.find(".wpProQuiz_question").each(function(){var c=b(this),e=c.find(".wpProQuiz_sortStringList");c.find(".wpProQuiz_sortStringItem").each(function(){e.append(b(this))})})},setTimeLimit:function(){var c=a.find(".wpProQuiz_time_limit"),e=c.find("span"),b=d.timeLimit;c.css({width:"100%",display:"block"});e.html(f.methode.parseTime(b));c.find(".progress").css("width","100%").animate({width:"0%"},1E3*d.timeLimit);j=setInterval(function(){e.html(f.methode.parseTime(b--));
0>b&&(clearInterval(j),j=0,c.find(".progress").clearQueue().stop(),a.find('input[name="check"]').click().parent().hide(),a.find(".wpProQuiz_time_limit_expired").show(),f.methode.showResult())},1E3)},parseTime:function(c){var e=parseInt(c%60),a=parseInt(c/60%60),c=parseInt(c/3600%24);return(9<c?"":"0")+c+":"+((9<a?"":"0")+a)+":"+((9<e?"":"0")+e)},setQuizTime:function(){var c=((new Date).getTime()-s.getTime())/1E3;a.find(".wpProQuiz_quiz_time span").first().html(f.methode.parseTime(c))},setData:function(){var c=
0;a.find(".wpProQuiz_questionList").each(function(){var e=d.json[c],a=0;l+=e.points;b(this).parent().parent().data("type",e.answer_type).data("questionId",e.id).data("points",e.points);b(this).find(".wpProQuiz_questionInput").each(function(){switch(e.answer_type){case "single":case "multiple":0<=b.inArray(this.value,e.correct)?b(this).data("correct","1"):b(this).data("correct","0");break;case "free_answer":b(this).data("correct",e.correct)}});a=0;b(this).find(".wpProQuiz_sortable").each(function(){b(this).data("correct",
e.correct[a++])});a=0;b(this).parent().find(".wpProQuiz_sortStringList").children().each(function(){b(this).data("correct",e.correct[a++])});"matrix_sort_answer"==e.answer_type&&b(this).children().each(function(){b(this).data("correct",b(this).index())});c++})},checkAnswer:function(c){var a=b(c).parent(),d=!1,i=a.find(".wpProQuiz_questionInput"),h=a.data("type");a.find('input[name="tip"]').hide();if(!a.data("isChecked")){if("multiple"==h||"single"==h){var g=!0;i.each(function(){"1"==b(this).data("correct")?
(b(this).parent().parent().addClass("wpProQuiz_answerCorrect"),g=this.checked?g&1:g&0):this.checked&&(b(this).parent().parent().addClass("wpProQuiz_answerIncorrect"),g&=0)});d=g}else if("sort_answer"==h){g=!0;a.find(".wpProQuiz_sortable").each(function(){var a=b(this),c=a.parent().index();a.data("correct")==c?(a.parent().addClass("wpProQuiz_answerCorrect"),g&=1):(a.parent().addClass("wpProQuiz_answerIncorrect"),g=!1);a.css({"box-shadow":"0 0",cursor:"auto"})});var j=a.find(".wpProQuiz_sortable").parent().parent(),
d=j.children("li");j.sortable("destroy");d.sort(function(a,c){return b(a).children("div").data("correct")-b(c).children("div").data("correct")});b.each(d,function(a,c){j.append(c)});d=g}else if("free_answer"==h)h=b.trim(i.val()).toLowerCase(),0<=b.inArray(h,i.data("correct"))?(d=!0,i.parent().parent().addClass("wpProQuiz_answerCorrect")):i.parent().parent().addClass("wpProQuiz_answerIncorrect");else if("matrix_sort_answer"==h){var g=!0,l={};a.find(".wpProQuiz_questionList").children().each(function(){var a=
b(this).data("correct"),c=b(this).find(".wpProQuiz_maxtrixSortCriterion");c.children().first().data("correct")==a?(g&=1,c.addClass("wpProQuiz_answerCorrect")):(g=!1,c.addClass("wpProQuiz_answerIncorrect"));l[a]=b(this)});a.find(".wpProQuiz_sortStringItem").each(function(){l[b(this).data("correct")].find(".wpProQuiz_maxtrixSortCriterion").append(this)}).css({"box-shadow":"0 0",cursor:"auto"});a.find(".wpProQuiz_sortStringList, .wpProQuiz_maxtrixSortCriterion").sortable("destroy");d=g}else"cloze_answer"==
h&&(g=!0,a.find(".wpProQuiz_cloze").each(function(){var a=b(this).children(),c=a.first(),e=c.val().toLowerCase(),d=a.last().text().toLowerCase(),d=b.trim(d.substr(1,d.length-2)),d=f.methode.cleanupCurlyQuotes(d),e=f.methode.cleanupCurlyQuotes(b.trim(e));d==e?(g&=1,c.css("background-color","#B0DAB0")):(g=!1,c.css("background-color","#FFBABA"),a.last().show());c.attr("disabled","disabled")}),d=g);b(c).hide();i.attr("disabled","disabled");void 0==k[a.data("questionId")]&&(k[a.data("questionId")]={});
k[a.data("questionId")].correct=Number(d);a.find(".wpProQuiz_response").show();d?(a.find(".wpProQuiz_correct").show(),n++,m+=a.data("points")):a.find(".wpProQuiz_incorrect").show();a.find('input[name="next"]').show();a.data("isChecked",!0)}},nextQuestion:function(c){var c=b(c).parent(),e=c.next();c.hide();e.length?(e.show(),d.backButton&&!d.checkAnswer&&e.find('input[name="back"]').show(),f.methode.scrollTo(e,!0)):(d.questionOnSinglePage&&a.find('.wpProQuiz_listItem, input[name="checkSingle"]').hide(),
(!d.checkAnswer||d.questionOnSinglePage)&&a.find('input[name="check"]').click(),f.methode.showResult())},backQuestion:function(a){var a=b(a).parent(),e=a.prev();a.hide();e.show();f.methode.scrollTo(e,!0)},showResult:function(){clearInterval(j);var c=a.find(".wpProQuiz_points span");a.find(".wpProQuiz_time_limit .progress").clearQueue().stop();a.find(".wpProQuiz_correct_answer").html(n);a.find(".wpProQuiz_results").show();a.find('.wpProQuiz_time_limit, input[name="checkSingle"]').hide();f.methode.setQuizTime();
var e=Math.round(1E4*(m/l))/100;c.eq(0).text(m);c.eq(1).text(l);c.eq(2).text(e);c=f.methode.findResultIndex(e);-1<c&&a.find(".wpProQuiz_resultsList").children().eq(c).show();f.methode.scrollTo(b(".wpProQuiz_results"),!0);f.methode.sendCompletedQuiz()},sendCompletedQuiz:function(){d.preview||b.post(d.url,{action:"wp_pro_quiz_completed_quiz",results:k,quizId:d.quizId})},findResultIndex:function(a){for(var b=d.resultsGrade,f=-1,i=999999,h=0;h<b.length;h++){var g=b[h];a>=g&&a-g<i&&(i=a-g,f=h)}return f},
cleanupCurlyQuotes:function(a){a=a.replace(/\u2018/,"'");a=a.replace(/\u2019/,"'");a=a.replace(/\u201C/,'"');return a=a.replace(/\u201D/,'"')},reShowQuestion:function(){a.find('input[name="next"], input[name="check"], input[name="back"], input[name="checkSingle"]').hide();a.find(".wpProQuiz_quiz").children().first().children().show();a.find(".wpProQuiz_question_page").hide()},answerRandom:function(c){a.find(c).each(function(){var a=b(this).children(),a=a.sort(function(){return Math.round(Math.random())-
0.5}).slice(0,a.length);b(a).appendTo(a[0].parentNode).show()})},questionRandom:function(){var c=a.find(".wpProQuiz_quiz ol").children(),c=c.sort(function(){return Math.round(Math.random())-0.5}).slice(0,c.length);b(c).appendTo(c[0].parentNode);var e=1;b(c).each(function(){b(this).find(".wpProQuiz_question_page span").eq(0).html(e);b(this).find("h3 span").html(e++)})},showTip:function(a){$tip=b(a).siblings(".wpProQuiz_tipp");$par=b(a).parent();void 0==k[$par.data("questionId")]&&(k[$par.data("questionId")]=
{});k[$par.data("questionId")].tip=1;$tip.toggle("fast")},setClozeStyle:function(){a.find(".wpProQuiz_cloze").each(function(){var a=b(this).children(),e=a.first(),a=a.last().clone();a.css("visibility","hidden");b("body").append(a);var d=a.width();a.remove();e.width(d+10)})},checkLock:function(){q=!0;b.post(d.url,{action:"wp_pro_quiz_check_lock",quizId:d.quizId},function(c){u=c.is;q=!1;c.pre&&a.find('input[name="restartQuiz"]').hide();r&&(r=!1,f.methode.startQuiz())},"json")}};f.init=function(){n=
0;d.lock&&!d.preview&&(t=!0,f.methode.checkLock());void 0==d.resultsGrade&&(d.resultsGrade=[0]);a.find(".wpProQuiz_quiz, .wpProQuiz_results").hide();a.find(".wpProQuiz_quiz").children().first().children().hide();f.methode.setData();f.methode.setClozeStyle();a.find('input[name="startQuiz"]').click(function(a){a.preventDefault();f.methode.preStartQuiz()});a.find('input[name="check"]').click(function(a){a.preventDefault();f.methode.checkAnswer(this)});a.find('input[name="next"]').click(function(a){a.preventDefault();
f.methode.nextQuestion(this)});a.find('input[name="restartQuiz"]').click(function(a){a.preventDefault();f.methode.reStartQuiz()});a.find('input[name="reShowQuestion"]').click(function(a){a.preventDefault();f.methode.reShowQuestion(this)});a.find('input[name="back"]').click(function(){f.methode.backQuestion(this)});a.find('input[name="tip"]').click(function(){f.methode.showTip(this)});a.find('input[name="checkSingle"]').click(function(){a.find('input[name="next"]').last().click()});b(document).mouseup(function(c){var b=
a.find(".wpProQuiz_tipp"),d=a.find('input[name="tip"]');!b.is(c.target)&&(0==b.has(c.target).length&&!d.is(c.target))&&b.hide("fast")})};f.init()};b.fn.wpProQuizFront=function(p){return this.each(function(){void 0==b(this).data("wpProQuizFront")&&b(this).data("wpProQuizFront",new b.wpProQuizFront(this,p))})}})(jQuery);
