(function(b){b.wpProQuizFront=function(j,f){var a=b(j),e=this,k=0,l=0,h=0,m=0,i={};e.methode={startQuiz:function(){i={};f.questionRandom&&e.methode.questionRandom();f.answerRandom?e.methode.answerRandom(".wpProQuiz_questionList"):e.methode.answerRandom(a.find(".wpProQuiz_sortable").parent().parent());f.timeLimit&&e.methode.setTimeLimit();k=0;m=new Date;f.checkAnswer?a.find('input[name="check"]').show():a.find('input[name="next"]').show();a.find(".wpProQuiz_text").hide();a.find(".wpProQuiz_quiz").show();
a.find(".wpProQuiz_listItem").first().fadeIn(200);a.find(".wpProQuiz_sortable").parent().parent().sortable().disableSelection();a.find(".wpProQuiz_sortStringList, .wpProQuiz_maxtrixSortCriterion").sortable({connectWith:".wpProQuiz_maxtrixSortCriterion:not(:has(li)), .wpProQuiz_sortStringList",placeholder:"wpProQuiz_placehold"}).disableSelection()},reStartQuiz:function(){a.find(".wpProQuiz_answerCorrect").removeClass("wpProQuiz_answerCorrect");a.find(".wpProQuiz_answerIncorrect").removeClass("wpProQuiz_answerIncorrect");
a.find('.wpProQuiz_text, input[name="tip"]').show();a.find(".wpProQuiz_quiz, .wpProQuiz_results, .wpProQuiz_response, .wpProQuiz_correct, .wpProQuiz_incorrect").hide();a.find(".wpProQuiz_time_limit, .wpProQuiz_time_limit_expired, .wpProQuiz_sort_correct_answer").hide();a.find(".wpProQuiz_quiz").children().first().children().hide();a.find(".wpProQuiz_sortable, .wpProQuiz_sortStringItem").removeAttr("style");a.find('input[name="check"]').hide();a.find('input[name="next"]').hide();a.find('input[name="question"]').removeAttr("disabled").removeAttr("checked");
a.find('input[name="question"][type="text"]').removeAttr("value");a.find(".wpProQuiz_resultsList").children().hide();e.methode.resetMatrix()},resetMatrix:function(){a.find(".wpProQuiz_question").each(function(){var d=b(this),c=d.find(".wpProQuiz_sortStringList");d.find(".wpProQuiz_sortStringItem").each(function(){c.append(b(this))})})},setTimeLimit:function(){var d=a.find(".wpProQuiz_time_limit"),c=d.find("span"),b=f.timeLimit;d.css({width:"100%",display:"block"});c.html(e.methode.parseTime(b));d.find(".progress").css("width",
"100%").animate({width:"0%"},1E3*f.timeLimit);h=setInterval(function(){c.html(e.methode.parseTime(b--));0>b&&(clearInterval(h),h=0,d.find(".progress").clearQueue().stop(),a.find('input[name="check"]').click().parent().hide(),a.find(".wpProQuiz_time_limit_expired").show(),e.methode.showResult())},1E3)},parseTime:function(d){var c=parseInt(d%60),b=parseInt(d/60%60),d=parseInt(d/3600%24);return(9<d?"":"0")+d+":"+((9<b?"":"0")+b)+":"+((9<c?"":"0")+c)},setQuizTime:function(){var d=((new Date).getTime()-
m.getTime())/1E3;a.find(".wpProQuiz_quiz_time span").first().html(e.methode.parseTime(d))},setData:function(){var d=0;a.find(".wpProQuiz_questionList").each(function(){var c=f.json[d],a=0;b(this).parent().parent().data("type",c.answer_type).data("questionId",c.id);b(this).find('input[name="question"]').each(function(){switch(c.answer_type){case "single":case "multiple":0<=b.inArray(this.value,c.correct)?b(this).data("correct","1"):b(this).data("correct","0");break;case "free_answer":b(this).data("correct",
c.correct)}});a=0;b(this).find(".wpProQuiz_sortable").each(function(){b(this).data("correct",c.correct[a++])});a=0;b(this).parent().find(".wpProQuiz_sortStringList").children().each(function(){b(this).data("correct",c.correct[a++]);console.debug(b(this))});d++})},checkAnswer:function(d){var c=b(d).parent(),a=!1,e=c.find('input[name="question"]'),f=c.data("type");c.find('input[name="tip"]').hide();if("multiple"==f||"single"==f){var g=!0;e.each(function(){"1"==b(this).data("correct")?(b(this).parent().parent().addClass("wpProQuiz_answerCorrect"),
g=this.checked?g&1:g&0):this.checked&&(b(this).parent().parent().addClass("wpProQuiz_answerIncorrect"),g&=0)});a=g}else if("sort_answer"==f){g=!0;c.find(".wpProQuiz_sortable").each(function(){var a=b(this),c=a.parent().index();a.data("correct")==c?(a.parent().addClass("wpProQuiz_answerCorrect"),g&=1):(a.parent().addClass("wpProQuiz_answerIncorrect"),g=!1);a.css({"box-shadow":"0 0",cursor:"auto"})});var h=c.find(".wpProQuiz_sortable").parent().parent(),a=h.children("li");h.sortable("destroy");a.sort(function(a,
c){return b(a).children("div").data("correct")>b(c).children("div").data("correct")});b.each(a,function(a,c){h.append(c)});a=g}else if("free_answer"==f)f=b.trim(e.val()).toLowerCase(),0<=b.inArray(f,e.data("correct"))?(a=!0,e.parent().parent().addClass("wpProQuiz_answerCorrect")):e.parent().parent().addClass("wpProQuiz_answerIncorrect");else if("matrix_sort_answer"==f){var g=!0,j=c.find(".wpProQuiz_questionList").children();j.each(function(){var a=b(this).index(),c=b(this).find(".wpProQuiz_maxtrixSortCriterion");
c.children().first().data("correct")==a?(g&=1,c.addClass("wpProQuiz_answerCorrect")):(g=!1,c.addClass("wpProQuiz_answerIncorrect"))});c.find(".wpProQuiz_sortStringItem").each(function(){j.eq(b(this).data("correct")).find(".wpProQuiz_maxtrixSortCriterion").append(this)}).css({"box-shadow":"0 0",cursor:"auto"});c.find(".wpProQuiz_sortStringList, .wpProQuiz_maxtrixSortCriterion").sortable("destroy");a=g}b(d).hide();e.attr("disabled","disabled");void 0==i[c.data("questionId")]&&(i[c.data("questionId")]=
{});i[c.data("questionId")].correct=Number(a);c.find(".wpProQuiz_response").show();a?(c.find(".wpProQuiz_correct").show(),k++):c.find(".wpProQuiz_incorrect").show();c.find('input[name="next"]').show()},nextQuestion:function(d){var d=b(d).parent(),c=d.next();d.hide();c.length?(c.show(),f.backButton&&!f.checkAnswer&&c.find('input[name="back"]').show()):(f.checkAnswer||a.find('input[name="check"]').click(),e.methode.showResult())},backQuestion:function(a){var a=b(a).parent(),c=a.prev();a.hide();c.show()},
showResult:function(){clearInterval(h);a.find(".wpProQuiz_time_limit .progress").clearQueue().stop();a.find(".wpProQuiz_points").html(k);a.find(".wpProQuiz_points_prozent").html("("+Math.round(100*(k/l))+"%)");a.find(".wpProQuiz_results").show();a.find(".wpProQuiz_time_limit").hide();e.methode.setQuizTime();var b=e.methode.findResultIndex(Math.round(1E4*(k/l))/100);-1<b&&a.find(".wpProQuiz_resultsList").children().eq(b).show();e.methode.sendStatistics()},findResultIndex:function(a){for(var c=f.resultsGrade,
b=-1,e=999999,h=0;h<c.length;h++){var g=c[h];a>=g&&a-g<e&&(e=a-g,b=h)}return b},sendStatistics:function(){f.statisticsOn&&b.ajax({url:f.url,type:"POST",cache:!1,data:{action:"wp_pro_quiz_statistics_save",results:i,quizId:f.quizId}})},reShowQuestion:function(){a.find('input[name="next"], input[name="check"], input[name="back"]').hide();a.find(".wpProQuiz_quiz").children().first().children().show()},answerRandom:function(d){a.find(d).each(function(){var a=b(this).children(),a=a.sort(function(){return Math.round(Math.random())-
0.5}).slice(0,a.length);b(a).appendTo(a[0].parentNode).show()})},questionRandom:function(){var d=a.find(".wpProQuiz_quiz ol").children(),d=d.sort(function(){return Math.round(Math.random())-0.5}).slice(0,d.length);b(d).appendTo(d[0].parentNode);var c=1;b(d).each(function(){b(this).find(".wpProQuiz_question_page span").eq(0).html(c);b(this).find("h3 span").html(c++)})},showTip:function(a){$tip=b(a).siblings(".wpProQuiz_tipp");$par=b(a).parent();void 0==i[$par.data("questionId")]&&(i[$par.data("questionId")]=
{});i[$par.data("questionId")].tip=1;$tip.toggle("fast")}};e.init=function(){k=0;void 0==f.resultsGrade&&(f.resultsGrade=[0]);a.find(".wpProQuiz_quiz, .wpProQuiz_results").hide();var d=a.find(".wpProQuiz_quiz").children().first().children();d.hide();l=d.length;e.methode.setData();a.find('input[name="startQuiz"]').click(function(a){a.preventDefault();e.methode.startQuiz()});a.find('input[name="check"]').click(function(a){a.preventDefault();e.methode.checkAnswer(this)});a.find('input[name="next"]').click(function(a){a.preventDefault();
e.methode.nextQuestion(this)});a.find('input[name="restartQuiz"]').click(function(a){a.preventDefault();e.methode.reStartQuiz()});a.find('input[name="reShowQuestion"]').click(function(a){a.preventDefault();e.methode.reShowQuestion(this)});a.find('input[name="back"]').click(function(){e.methode.backQuestion(this)});a.find('input[name="tip"]').click(function(){e.methode.showTip(this)});b(document).mouseup(function(b){var d=a.find(".wpProQuiz_tipp"),e=a.find('input[name="tip"]');!d.is(b.target)&&(0==
d.has(b.target).length&&!e.is(b.target))&&d.hide("fast")})};e.init()};b.fn.wpProQuizFront=function(j){return this.each(function(){void 0==b(this).data("wpProQuizFront")&&b(this).data("wpProQuizFront",new b.wpProQuizFront(this,j))})}})(jQuery);
